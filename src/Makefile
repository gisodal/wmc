PROJECTS = quine-mccluskey bn-to-cnf bnc-cudd bnc bnmc-dlib bnmc
OPTIONS  = all static install
SHELL    = /bin/bash
MAKEFILE = ~/trunk/gpm/Makefile

.PHONY: all clean debug build install update pull

all:     OPTIONS = all static install
all:     build

debug:   OPTIONS = debug debug-static install
debug:   build

install: OPTIONS = install
install: build

lines:
	@for PROJECT in $(PROJECTS); do 							\
		DIRS="$${DIRS} $${PROJECT}/src $${PROJECT}/include"; 	\
	done; 														\
	find $${DIRS} -maxdepth 1 -type f | xargs wc -l;

clean:   OPTIONS = clean
clean:   build

build:
	@for PROJECT in $(PROJECTS); do                     				\
		echo -e "\n==== processing $${PROJECT} ====\n"; 				\
		if [ $${PROJECT} == bnc-cudd ]; then 							\
		    $(MAKE) -C $${PROJECT} check 2>/dev/null && 				\
			$(MAKE) -C $${PROJECT} $(OPTIONS);  						\
 		elif [ $${PROJECT} == bnmc ]; then 								\
			if [ "$(firstword $(OPTIONS))" == "all" ]; then 			\
				$(MAKE) -C $${PROJECT} dlib $(OPTIONS) || exit 1;		\
			elif [ "$(firstword $(OPTIONS))" == "debug" ]; then 		\
				$(MAKE) -C $${PROJECT} debug-dlib $(OPTIONS) || exit 1;	\
			else                                                		\
				$(MAKE) -C $${PROJECT} $(OPTIONS) || exit 1;       		\
			fi;															\
		else 															\
			$(MAKE) -C $${PROJECT} $(OPTIONS) || exit 1;       			\
		fi; 															\
	done

$(MAKEFILE):
	$(error $(MAKEFILE) not found..)

%/Makefile: $(MAKEFILE)
	@echo UPDATE $@
	@cp $< $@

update:
	@for PROJECT in $(PROJECTS); do                     		\
		echo -e "\n==== processing $${PROJECT} ====\n"; 		\
		$(MAKE) $${PROJECT}/Makefile;							\
	done

pull:
	@for PROJECT in $(PROJECTS); do                     		\
		echo -e "\n==== processing $${PROJECT} ====\n"; 		\
		$(MAKE) -C $${PROJECT} pull;							\
	done

